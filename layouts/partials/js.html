<script>

function setStorage(key,value){
	document.body.setAttribute(key, value);
	localStorage.setItem(key, value);
}

function setDefault(key,value) {
	if (localStorage.getItem(key) == null) {
		setStorage(key,value)
	} else {
		setStorage(key, localStorage.getItem(key))
	}
}
setDefault('theme','dark')
setDefault('fontsize','20px')
setDefault('font','Helvetica')

function updateRelativeTimes() {
	const roots = document.querySelectorAll('[data-lastmod]')
	const units = [
		{ seconds: 365 * 24 * 60 * 60, singular: "책r", plural: "책r" },
		{ seconds: 30 * 24 * 60 * 60, singular: "m책nad", plural: "m책nader" },
		{ seconds: 24 * 60 * 60, singular: "dag", plural: "dagar" },
		{ seconds: 60 * 60, singular: "timme", plural: "timmar" },
		{ seconds: 60, singular: "minut", plural: "minuter" },
	]

	for (const root of roots) {
		const lastmodUnix = Number(root.dataset.lastmod || 0)
		if (!Number.isFinite(lastmodUnix) || lastmodUnix <= 0) continue

		const nowUnix = Math.floor(Date.now() / 1000)
		const diffSeconds = Math.max(0, nowUnix - lastmodUnix)

		let value = 0
		let unitText = "minuter"

		for (const unit of units) {
			if (diffSeconds >= unit.seconds) {
				value = Math.floor(diffSeconds / unit.seconds)
				unitText = value === 1 ? unit.singular : unit.plural
				break
			}
		}

		const target = root.querySelector('.relative-time-value')
		if (target) target.textContent = `${value} ${unitText}`
	}
}

if (document.readyState === 'loading') {
	document.addEventListener('DOMContentLoaded', updateRelativeTimes)
} else {
	updateRelativeTimes()
}

</script>
