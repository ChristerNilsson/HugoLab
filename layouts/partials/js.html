<script>

function setStorage(key,value){
	document.body.setAttribute(key, value);
	localStorage.setItem(key, value);
}

function setDefault(key,value) {
	if (localStorage.getItem(key) == null) {
		setStorage(key,value)
	} else {
		setStorage(key, localStorage.getItem(key))
	}
}
setDefault('theme','dark')
setDefault('fontsize','20px')
setDefault('font','Helvetica')

function updateRelativeTimes() {
	const roots = document.querySelectorAll('[data-lastmod]')
	const units = [
		{ seconds: 365 * 24 * 60 * 60, singular: "ett år", plural: "år" },
		{ seconds: 30 * 24 * 60 * 60, singular: "en månad", plural: "månader" },
		{ seconds: 24 * 60 * 60, singular: "en dag", plural: "dagar" },
		{ seconds: 60 * 60, singular: "en timme", plural: "timmar" },
		{ seconds: 60, singular: "en minut", plural: "minuter" },
	]

	for (const root of roots) {
		const lastmodUnix = Number(root.dataset.lastmod || 0)
		if (!Number.isFinite(lastmodUnix) || lastmodUnix <= 0) continue

		const nowUnix = Math.floor(Date.now() / 1000)
		const diffSeconds = Math.max(0, nowUnix - lastmodUnix)

		let value = 0
		let text = "nyss"

		for (const unit of units) {
			if (diffSeconds >= unit.seconds) {
				value = Math.floor(diffSeconds / unit.seconds)
				text = value === 1 ? unit.singular : `${value} ${unit.plural}`
				break
			}
		}

		const target = root.querySelector('.relative-time-value')
		if (target) target.textContent = text === "nyss" ? text : `för ${text} sedan`
	}
}

if (document.readyState === 'loading') {
	document.addEventListener('DOMContentLoaded', updateRelativeTimes)
} else {
	updateRelativeTimes()
}

</script>
